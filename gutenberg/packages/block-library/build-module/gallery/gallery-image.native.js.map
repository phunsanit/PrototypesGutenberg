{"version":3,"sources":["@wordpress/block-library/src/gallery/gallery-image.native.js"],"names":["Image","StyleSheet","View","ScrollView","Text","TouchableWithoutFeedback","requestImageFailedRetryDialog","requestImageUploadCancelDialog","isEmpty","Component","Icon","__","sprintf","Caption","MediaUploadProgress","getProtocol","withPreferredColorScheme","close","arrowLeft","arrowRight","Button","style","compose","separatorStyle","separator","borderRightWidth","hairlineWidth","buttonStyle","button","aspectRatio","removeButtonStyle","removeButton","ICON_SIZE_ARROW","ICON_SIZE_REMOVE","GalleryImage","arguments","onSelectImage","bind","onSelectCaption","onMediaPressed","onCaptionChange","bindContainer","updateMediaProgress","finishMediaUploadWithSuccess","finishMediaUploadWithFailure","renderContent","state","captionSelected","isUploadInProgress","didUploadFail","ref","container","setState","props","isSelected","onSelect","id","url","isBlockSelected","onSelectBlock","caption","setAttributes","prevProps","image","source_url","alt","alt_text","payload","mediaServerId","mediaUrl","params","isFirstItem","isLastItem","onRemove","onMoveForward","onMoveBackward","ariaLabel","isCropped","getStylesFromColorScheme","isRTL","isUploadFailed","retryMessage","resizeMode","imageStyle","imageUploading","undefined","overlayStyle","overlay","overlaySelected","captionPlaceholderStyle","captionPlaceholder","captionPlaceholderDark","shouldShowCaptionEditable","shouldShowCaptionExpanded","captionContainerStyle","captionExpandedContainer","captionContainer","captionStyle","captionExpanded","captionDark","uri","uploadFailedContainer","uploadFailed","uploadFailedIcon","uploadFailedText","toolbar","moverButtonContainer","color","containerStyle","galleryImageContainer","galleryImageContainerDark","accessibilityLabelImageContainer"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tImage,\n\tStyleSheet,\n\tView,\n\tScrollView,\n\tText,\n\tTouchableWithoutFeedback,\n} from 'react-native';\nimport {\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n} from 'react-native-gutenberg-bridge';\nimport { isEmpty } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { Icon } from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Caption, MediaUploadProgress } from '@wordpress/block-editor';\nimport { getProtocol } from '@wordpress/url';\nimport { withPreferredColorScheme } from '@wordpress/compose';\nimport { close, arrowLeft, arrowRight } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport Button from './gallery-button';\nimport style from './gallery-image-style.scss';\n\nconst { compose } = StyleSheet;\n\nconst separatorStyle = compose( style.separator, {\n\tborderRightWidth: StyleSheet.hairlineWidth,\n} );\nconst buttonStyle = compose( style.button, { aspectRatio: 1 } );\nconst removeButtonStyle = compose( style.removeButton, { aspectRatio: 1 } );\nconst ICON_SIZE_ARROW = 15;\nconst ICON_SIZE_REMOVE = 20;\n\nclass GalleryImage extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onSelectImage = this.onSelectImage.bind( this );\n\t\tthis.onSelectCaption = this.onSelectCaption.bind( this );\n\t\tthis.onMediaPressed = this.onMediaPressed.bind( this );\n\t\tthis.onCaptionChange = this.onCaptionChange.bind( this );\n\t\tthis.bindContainer = this.bindContainer.bind( this );\n\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.finishMediaUploadWithSuccess = this.finishMediaUploadWithSuccess.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.finishMediaUploadWithFailure = this.finishMediaUploadWithFailure.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.renderContent = this.renderContent.bind( this );\n\n\t\tthis.state = {\n\t\t\tcaptionSelected: false,\n\t\t\tisUploadInProgress: false,\n\t\t\tdidUploadFail: false,\n\t\t};\n\t}\n\n\tbindContainer( ref ) {\n\t\tthis.container = ref;\n\t}\n\n\tonSelectCaption() {\n\t\tif ( ! this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: true,\n\t\t\t} );\n\t\t}\n\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\t}\n\n\tonMediaPressed() {\n\t\tconst { id, url } = this.props;\n\n\t\tthis.onSelectImage();\n\n\t\tif ( this.state.isUploadInProgress ) {\n\t\t\trequestImageUploadCancelDialog( id );\n\t\t} else if (\n\t\t\tthis.state.didUploadFail ||\n\t\t\t( id && getProtocol( url ) === 'file:' )\n\t\t) {\n\t\t\trequestImageFailedRetryDialog( id );\n\t\t}\n\t}\n\n\tonSelectImage() {\n\t\tif ( ! this.props.isBlockSelected ) {\n\t\t\tthis.props.onSelectBlock();\n\t\t}\n\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\n\t\tif ( this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonCaptionChange( caption ) {\n\t\tconst { setAttributes } = this.props;\n\t\tsetAttributes( { caption } );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { isSelected, image, url } = this.props;\n\t\tif ( image && ! url ) {\n\t\t\tthis.props.setAttributes( {\n\t\t\t\turl: image.source_url,\n\t\t\t\talt: image.alt_text,\n\t\t\t} );\n\t\t}\n\n\t\t// unselect the caption so when the user selects other image and comeback\n\t\t// the caption is not immediately selected\n\t\tif (\n\t\t\tthis.state.captionSelected &&\n\t\t\t! isSelected &&\n\t\t\tprevProps.isSelected\n\t\t) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tupdateMediaProgress() {\n\t\tif ( ! this.state.isUploadInProgress ) {\n\t\t\tthis.setState( { isUploadInProgress: true } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tthis.setState( {\n\t\t\tisUploadInProgress: false,\n\t\t\tdidUploadFail: false,\n\t\t} );\n\n\t\tthis.props.setAttributes( {\n\t\t\tid: payload.mediaServerId,\n\t\t\turl: payload.mediaUrl,\n\t\t} );\n\t}\n\n\tfinishMediaUploadWithFailure() {\n\t\tthis.setState( {\n\t\t\tisUploadInProgress: false,\n\t\t\tdidUploadFail: true,\n\t\t} );\n\t}\n\n\trenderContent( params ) {\n\t\tconst {\n\t\t\turl,\n\t\t\tisFirstItem,\n\t\t\tisLastItem,\n\t\t\tisSelected,\n\t\t\tcaption,\n\t\t\tonRemove,\n\t\t\tonMoveForward,\n\t\t\tonMoveBackward,\n\t\t\t'aria-label': ariaLabel,\n\t\t\tisCropped,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tisRTL,\n\t\t} = this.props;\n\n\t\tconst { isUploadInProgress, captionSelected } = this.state;\n\t\tconst { isUploadFailed, retryMessage } = params;\n\t\tconst resizeMode = isCropped ? 'cover' : 'contain';\n\n\t\tconst imageStyle = [\n\t\t\tstyle.image,\n\t\t\t{ resizeMode },\n\t\t\tisUploadInProgress ? style.imageUploading : undefined,\n\t\t];\n\n\t\tconst overlayStyle = compose(\n\t\t\tstyle.overlay,\n\t\t\tisSelected ? style.overlaySelected : undefined\n\t\t);\n\n\t\tconst captionPlaceholderStyle = getStylesFromColorScheme(\n\t\t\tstyle.captionPlaceholder,\n\t\t\tstyle.captionPlaceholderDark\n\t\t);\n\n\t\tconst shouldShowCaptionEditable = ! isUploadFailed && isSelected;\n\t\tconst shouldShowCaptionExpanded =\n\t\t\t! isUploadFailed && ! isSelected && !! caption;\n\n\t\tconst captionContainerStyle = shouldShowCaptionExpanded\n\t\t\t? style.captionExpandedContainer\n\t\t\t: style.captionContainer;\n\n\t\tconst captionStyle = shouldShowCaptionExpanded\n\t\t\t? style.captionExpanded\n\t\t\t: getStylesFromColorScheme( style.caption, style.captionDark );\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<Image\n\t\t\t\t\tstyle={ imageStyle }\n\t\t\t\t\tsource={ { uri: url } }\n\t\t\t\t\t// alt={ alt }\n\t\t\t\t\taccessibilityLabel={ ariaLabel }\n\t\t\t\t\tref={ this.bindContainer }\n\t\t\t\t/>\n\t\t\t\t{ isUploadFailed && (\n\t\t\t\t\t<View style={ style.uploadFailedContainer }>\n\t\t\t\t\t\t<View style={ style.uploadFailed }>\n\t\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\t\ticon={ 'warning' }\n\t\t\t\t\t\t\t\t{ ...style.uploadFailedIcon }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</View>\n\t\t\t\t\t\t<Text style={ style.uploadFailedText }>\n\t\t\t\t\t\t\t{ retryMessage }\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</View>\n\t\t\t\t) }\n\t\t\t\t<View style={ overlayStyle }>\n\t\t\t\t\t{ ! isUploadInProgress && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{ isSelected && (\n\t\t\t\t\t\t\t\t<View style={ style.toolbar }>\n\t\t\t\t\t\t\t\t\t<View style={ style.moverButtonContainer }>\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tstyle={ buttonStyle }\n\t\t\t\t\t\t\t\t\t\t\ticon={\n\t\t\t\t\t\t\t\t\t\t\t\tisRTL ? arrowRight : arrowLeft\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\ticonSize={ ICON_SIZE_ARROW }\n\t\t\t\t\t\t\t\t\t\t\tonClick={\n\t\t\t\t\t\t\t\t\t\t\t\tisFirstItem\n\t\t\t\t\t\t\t\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t\t\t\t\t\t\t\t: onMoveBackward\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\taccessibilityLabel={ __(\n\t\t\t\t\t\t\t\t\t\t\t\t'Move Image Backward'\n\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\taria-disabled={ isFirstItem }\n\t\t\t\t\t\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<View style={ separatorStyle }></View>\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tstyle={ buttonStyle }\n\t\t\t\t\t\t\t\t\t\t\ticon={\n\t\t\t\t\t\t\t\t\t\t\t\tisRTL ? arrowLeft : arrowRight\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\ticonSize={ ICON_SIZE_ARROW }\n\t\t\t\t\t\t\t\t\t\t\tonClick={\n\t\t\t\t\t\t\t\t\t\t\t\tisLastItem\n\t\t\t\t\t\t\t\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t\t\t\t\t\t\t\t: onMoveForward\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\taccessibilityLabel={ __(\n\t\t\t\t\t\t\t\t\t\t\t\t'Move Image Forward'\n\t\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\t\taria-disabled={ isLastItem }\n\t\t\t\t\t\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tstyle={ removeButtonStyle }\n\t\t\t\t\t\t\t\t\t\ticon={ close }\n\t\t\t\t\t\t\t\t\t\ticonSize={ ICON_SIZE_REMOVE }\n\t\t\t\t\t\t\t\t\t\tonClick={ onRemove }\n\t\t\t\t\t\t\t\t\t\taccessibilityLabel={ __(\n\t\t\t\t\t\t\t\t\t\t\t'Remove Image'\n\t\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t{ ( shouldShowCaptionEditable ||\n\t\t\t\t\t\t\t\tshouldShowCaptionExpanded ) && (\n\t\t\t\t\t\t\t\t<View style={ captionContainerStyle }>\n\t\t\t\t\t\t\t\t\t<ScrollView\n\t\t\t\t\t\t\t\t\t\tnestedScrollEnabled\n\t\t\t\t\t\t\t\t\t\tkeyboardShouldPersistTaps=\"handled\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Caption\n\t\t\t\t\t\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t\t\t\t\t\t\tisSelected={ captionSelected }\n\t\t\t\t\t\t\t\t\t\t\tonChange={ this.onCaptionChange }\n\t\t\t\t\t\t\t\t\t\t\tonFocus={ this.onSelectCaption }\n\t\t\t\t\t\t\t\t\t\t\tplaceholder={\n\t\t\t\t\t\t\t\t\t\t\t\tisSelected\n\t\t\t\t\t\t\t\t\t\t\t\t\t? __( 'Write captionâ€¦' )\n\t\t\t\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tplaceholderTextColor={\n\t\t\t\t\t\t\t\t\t\t\t\tcaptionPlaceholderStyle.color\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tstyle={ captionStyle }\n\t\t\t\t\t\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</ScrollView>\n\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t</>\n\t\t\t\t\t) }\n\t\t\t\t</View>\n\t\t\t</>\n\t\t);\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tid,\n\t\t\tonRemove,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tisSelected,\n\t\t} = this.props;\n\n\t\tconst containerStyle = getStylesFromColorScheme(\n\t\t\tstyle.galleryImageContainer,\n\t\t\tstyle.galleryImageContainerDark\n\t\t);\n\n\t\treturn (\n\t\t\t<TouchableWithoutFeedback\n\t\t\t\tonPress={ this.onMediaPressed }\n\t\t\t\taccessible={ ! isSelected } // We need only child views to be accessible after the selection\n\t\t\t\taccessibilityLabel={ this.accessibilityLabelImageContainer() } // if we don't set this explicitly it reads system provided accessibilityLabels of all child components and those include pretty technical words which don't make sense\n\t\t\t\taccessibilityRole={ 'imagebutton' } // this makes VoiceOver to read a description of image provided by system on iOS and lets user know this is a button which conveys the message of tappablity\n\t\t\t>\n\t\t\t\t<View style={ containerStyle }>\n\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonMediaUploadStateReset={ onRemove }\n\t\t\t\t\t\trenderContent={ this.renderContent }\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t</TouchableWithoutFeedback>\n\t\t);\n\t}\n\n\taccessibilityLabelImageContainer() {\n\t\tconst { caption, 'aria-label': ariaLabel } = this.props;\n\n\t\treturn isEmpty( caption )\n\t\t\t? ariaLabel\n\t\t\t: ariaLabel +\n\t\t\t\t\t'. ' +\n\t\t\t\t\tsprintf(\n\t\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\t\tcaption\n\t\t\t\t\t);\n\t}\n}\n\nexport default withPreferredColorScheme( GalleryImage );\n"]}