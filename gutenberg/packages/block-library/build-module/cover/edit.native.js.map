{"version":3,"sources":["@wordpress/block-library/src/cover/edit.native.js"],"names":["View","TouchableWithoutFeedback","requestImageFailedRetryDialog","requestImageUploadCancelDialog","mediaUploadSync","Video","__","Icon","ImageWithFocalPoint","PanelBody","RangeControl","ToolbarButton","ToolbarGroup","Gradient","BlockControls","InnerBlocks","InspectorControls","MEDIA_TYPE_IMAGE","MEDIA_TYPE_VIDEO","MediaPlaceholder","MediaUpload","MediaUploadProgress","withColors","__experimentalUseGradient","compose","withPreferredColorScheme","withSelect","useEffect","useState","cover","icon","replace","getProtocol","styles","attributesFromMedia","COVER_MIN_HEIGHT","IMAGE_BACKGROUND_TYPE","VIDEO_BACKGROUND_TYPE","OverlayColorSettings","ALLOWED_MEDIA_TYPES","INNER_BLOCKS_TEMPLATE","align","placeholder","COVER_MAX_HEIGHT","COVER_DEFAULT_HEIGHT","Cover","attributes","getStylesFromColorScheme","isParentSelected","onFocus","overlayColor","setAttributes","backgroundType","dimRatio","focalPoint","minHeight","url","id","style","customOverlayColor","CONTAINER_HEIGHT","gradientValue","hasBackground","color","background","overlay","childrenStyles","defaultColor","isUploadInProgress","setIsUploadInProgress","didUploadFail","setDidUploadFail","shouldShowFailure","onSelectMedia","media","onSelect","gradient","undefined","customGradient","onHeightChange","value","onOpactiyChange","onMediaPressed","isVideoLoading","setIsVideoLoading","onVideoLoadStart","onVideoLoad","backgroundColor","backgroundSolid","backgroundSolidDark","overlayStyles","opacity","placeholderIconStyle","iconDark","placeholderIcon","toolbarControls","open","controls","rangeCellContainer","renderBackground","openMediaOptions","getMediaOptions","mediaServerId","mediaUrl","uri","title","backgroundContainer","content","uploadFailedContainer","uploadFailed","uploadFailedIcon","select","clientId","getSelectedBlockClientId","selectedBlockClientId"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { View, TouchableWithoutFeedback } from 'react-native';\nimport {\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n\tmediaUploadSync,\n} from 'react-native-gutenberg-bridge';\nimport Video from 'react-native-video';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport {\n\tIcon,\n\tImageWithFocalPoint,\n\tPanelBody,\n\tRangeControl,\n\tToolbarButton,\n\tToolbarGroup,\n\tGradient,\n} from '@wordpress/components';\nimport {\n\tBlockControls,\n\tInnerBlocks,\n\tInspectorControls,\n\tMEDIA_TYPE_IMAGE,\n\tMEDIA_TYPE_VIDEO,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMediaUploadProgress,\n\twithColors,\n\t__experimentalUseGradient,\n} from '@wordpress/block-editor';\nimport { compose, withPreferredColorScheme } from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\nimport { useEffect, useState } from '@wordpress/element';\nimport { cover as icon, replace } from '@wordpress/icons';\nimport { getProtocol } from '@wordpress/url';\n\n/**\n * Internal dependencies\n */\nimport styles from './style.scss';\nimport {\n\tattributesFromMedia,\n\tCOVER_MIN_HEIGHT,\n\tIMAGE_BACKGROUND_TYPE,\n\tVIDEO_BACKGROUND_TYPE,\n} from './shared';\nimport OverlayColorSettings from './overlay-color-settings';\n\n/**\n * Constants\n */\nconst ALLOWED_MEDIA_TYPES = [ MEDIA_TYPE_IMAGE, MEDIA_TYPE_VIDEO ];\nconst INNER_BLOCKS_TEMPLATE = [\n\t[\n\t\t'core/paragraph',\n\t\t{\n\t\t\talign: 'center',\n\t\t\tplaceholder: __( 'Write titleâ€¦' ),\n\t\t},\n\t],\n];\nconst COVER_MAX_HEIGHT = 1000;\nconst COVER_DEFAULT_HEIGHT = 300;\n\nconst Cover = ( {\n\tattributes,\n\tgetStylesFromColorScheme,\n\tisParentSelected,\n\tonFocus,\n\toverlayColor,\n\tsetAttributes,\n} ) => {\n\tconst {\n\t\tbackgroundType,\n\t\tdimRatio,\n\t\tfocalPoint,\n\t\tminHeight,\n\t\turl,\n\t\tid,\n\t\tstyle,\n\t\tcustomOverlayColor,\n\t} = attributes;\n\tconst CONTAINER_HEIGHT = minHeight || COVER_DEFAULT_HEIGHT;\n\n\tconst { gradientValue } = __experimentalUseGradient();\n\n\tconst hasBackground = !! (\n\t\turl ||\n\t\t( style && style.color && style.color.background ) ||\n\t\tattributes.overlayColor ||\n\t\toverlayColor.color ||\n\t\tgradientValue\n\t);\n\n\t// Used to set a default color for its InnerBlocks\n\t// since there's no system to inherit styles yet\n\t// the RichText component will check if there are\n\t// parent styles for the current block. If there are,\n\t// it will use that color instead.\n\tuseEffect( () => {\n\t\t// While we don't support theme colors\n\t\tif ( ! attributes.overlayColor || ( ! attributes.overlay && url ) ) {\n\t\t\tsetAttributes( { childrenStyles: styles.defaultColor } );\n\t\t}\n\t}, [ setAttributes ] );\n\n\t// sync with local media store\n\tuseEffect( mediaUploadSync, [] );\n\n\t// initialize uploading flag to false, awaiting sync\n\tconst [ isUploadInProgress, setIsUploadInProgress ] = useState( false );\n\n\t// initialize upload failure flag to true if url is local\n\tconst [ didUploadFail, setDidUploadFail ] = useState(\n\t\tid && getProtocol( url ) === 'file:'\n\t);\n\n\t// don't show failure if upload is in progress\n\tconst shouldShowFailure = didUploadFail && ! isUploadInProgress;\n\n\tconst onSelectMedia = ( media ) => {\n\t\tsetDidUploadFail( false );\n\t\tconst onSelect = attributesFromMedia( setAttributes );\n\t\t// Remove gradient attribute\n\t\tsetAttributes( { gradient: undefined, customGradient: undefined } );\n\t\tonSelect( media );\n\t};\n\n\tconst onHeightChange = ( value ) => {\n\t\tif ( minHeight || value !== COVER_DEFAULT_HEIGHT ) {\n\t\t\tsetAttributes( { minHeight: value } );\n\t\t}\n\t};\n\n\tconst onOpactiyChange = ( value ) => {\n\t\tsetAttributes( { dimRatio: value } );\n\t};\n\n\tconst onMediaPressed = () => {\n\t\tif ( isUploadInProgress ) {\n\t\t\trequestImageUploadCancelDialog( id );\n\t\t} else if ( shouldShowFailure ) {\n\t\t\trequestImageFailedRetryDialog( id );\n\t\t}\n\t};\n\n\tconst [ isVideoLoading, setIsVideoLoading ] = useState( true );\n\n\tconst onVideoLoadStart = () => {\n\t\tsetIsVideoLoading( true );\n\t};\n\n\tconst onVideoLoad = () => {\n\t\tsetIsVideoLoading( false );\n\t};\n\n\tconst backgroundColor = getStylesFromColorScheme(\n\t\tstyles.backgroundSolid,\n\t\tstyles.backgroundSolidDark\n\t);\n\n\tconst overlayStyles = [\n\t\tstyles.overlay,\n\t\turl && { opacity: dimRatio / 100 },\n\t\t! gradientValue && {\n\t\t\tbackgroundColor:\n\t\t\t\tcustomOverlayColor ||\n\t\t\t\toverlayColor?.color ||\n\t\t\t\tstyle?.color?.background ||\n\t\t\t\tstyles.overlay.color,\n\t\t},\n\t\t// While we don't support theme colors we add a default bg color\n\t\t! overlayColor.color && ! url ? backgroundColor : {},\n\t];\n\n\tconst placeholderIconStyle = getStylesFromColorScheme(\n\t\tstyles.icon,\n\t\tstyles.iconDark\n\t);\n\n\tconst placeholderIcon = <Icon icon={ icon } { ...placeholderIconStyle } />;\n\n\tconst toolbarControls = ( open ) => (\n\t\t<BlockControls>\n\t\t\t<ToolbarGroup>\n\t\t\t\t<ToolbarButton\n\t\t\t\t\ttitle={ __( 'Edit cover media' ) }\n\t\t\t\t\ticon={ replace }\n\t\t\t\t\tonClick={ open }\n\t\t\t\t/>\n\t\t\t</ToolbarGroup>\n\t\t</BlockControls>\n\t);\n\n\tconst controls = (\n\t\t<InspectorControls>\n\t\t\t<OverlayColorSettings\n\t\t\t\tattributes={ attributes }\n\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t/>\n\t\t\t<PanelBody title={ __( 'Dimensions' ) }>\n\t\t\t\t<RangeControl\n\t\t\t\t\tlabel={ __( 'Minimum height in pixels' ) }\n\t\t\t\t\tminimumValue={ COVER_MIN_HEIGHT }\n\t\t\t\t\tmaximumValue={ COVER_MAX_HEIGHT }\n\t\t\t\t\tvalue={ CONTAINER_HEIGHT }\n\t\t\t\t\tonChange={ onHeightChange }\n\t\t\t\t\tstyle={ styles.rangeCellContainer }\n\t\t\t\t/>\n\t\t\t</PanelBody>\n\t\t\t{ url ? (\n\t\t\t\t<PanelBody title={ __( 'Overlay' ) }>\n\t\t\t\t\t<RangeControl\n\t\t\t\t\t\tlabel={ __( 'Background Opacity' ) }\n\t\t\t\t\t\tminimumValue={ 0 }\n\t\t\t\t\t\tmaximumValue={ 100 }\n\t\t\t\t\t\tvalue={ dimRatio }\n\t\t\t\t\t\tonChange={ onOpactiyChange }\n\t\t\t\t\t\tstyle={ styles.rangeCellContainer }\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t) : null }\n\t\t</InspectorControls>\n\t);\n\n\tconst renderBackground = ( {\n\t\topen: openMediaOptions,\n\t\tgetMediaOptions,\n\t} ) => (\n\t\t<TouchableWithoutFeedback\n\t\t\taccessible={ ! isParentSelected }\n\t\t\tonPress={ onMediaPressed }\n\t\t\tonLongPress={ openMediaOptions }\n\t\t\tdisabled={ ! isParentSelected }\n\t\t>\n\t\t\t<View style={ [ styles.background, backgroundColor ] }>\n\t\t\t\t{ getMediaOptions() }\n\t\t\t\t{ isParentSelected && toolbarControls( openMediaOptions ) }\n\t\t\t\t<MediaUploadProgress\n\t\t\t\t\tmediaId={ id }\n\t\t\t\t\tonUpdateMediaProgress={ () => {\n\t\t\t\t\t\tsetIsUploadInProgress( true );\n\t\t\t\t\t} }\n\t\t\t\t\tonFinishMediaUploadWithSuccess={ ( {\n\t\t\t\t\t\tmediaServerId,\n\t\t\t\t\t\tmediaUrl,\n\t\t\t\t\t} ) => {\n\t\t\t\t\t\tsetIsUploadInProgress( false );\n\t\t\t\t\t\tsetDidUploadFail( false );\n\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\tid: mediaServerId,\n\t\t\t\t\t\t\turl: mediaUrl,\n\t\t\t\t\t\t\tbackgroundType,\n\t\t\t\t\t\t} );\n\t\t\t\t\t} }\n\t\t\t\t\tonFinishMediaUploadWithFailure={ () => {\n\t\t\t\t\t\tsetIsUploadInProgress( false );\n\t\t\t\t\t\tsetDidUploadFail( true );\n\t\t\t\t\t} }\n\t\t\t\t\tonMediaUploadStateReset={ () => {\n\t\t\t\t\t\tsetIsUploadInProgress( false );\n\t\t\t\t\t\tsetDidUploadFail( false );\n\t\t\t\t\t\tsetAttributes( { id: undefined, url: undefined } );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t\t{ IMAGE_BACKGROUND_TYPE === backgroundType && (\n\t\t\t\t\t<ImageWithFocalPoint\n\t\t\t\t\t\tfocalPoint={ focalPoint }\n\t\t\t\t\t\turl={ url }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t{ VIDEO_BACKGROUND_TYPE === backgroundType && (\n\t\t\t\t\t<Video\n\t\t\t\t\t\tmuted\n\t\t\t\t\t\tdisableFocus\n\t\t\t\t\t\trepeat\n\t\t\t\t\t\tresizeMode={ 'cover' }\n\t\t\t\t\t\tsource={ { uri: url } }\n\t\t\t\t\t\tonLoad={ onVideoLoad }\n\t\t\t\t\t\tonLoadStart={ onVideoLoadStart }\n\t\t\t\t\t\tstyle={ [\n\t\t\t\t\t\t\tstyles.background,\n\t\t\t\t\t\t\t// Hide Video component since it has black background while loading the source\n\t\t\t\t\t\t\t{ opacity: isVideoLoading ? 0 : 1 },\n\t\t\t\t\t\t] }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</View>\n\t\t</TouchableWithoutFeedback>\n\t);\n\n\tif ( ! hasBackground ) {\n\t\treturn (\n\t\t\t<View>\n\t\t\t\t<MediaPlaceholder\n\t\t\t\t\ticon={ placeholderIcon }\n\t\t\t\t\tlabels={ {\n\t\t\t\t\t\ttitle: __( 'Cover' ),\n\t\t\t\t\t} }\n\t\t\t\t\tonSelect={ onSelectMedia }\n\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\tonFocus={ onFocus }\n\t\t\t\t/>\n\t\t\t</View>\n\t\t);\n\t}\n\n\treturn (\n\t\t<View style={ styles.backgroundContainer }>\n\t\t\t{ controls }\n\n\t\t\t<View\n\t\t\t\tpointerEvents=\"box-none\"\n\t\t\t\tstyle={ [ styles.content, { minHeight: CONTAINER_HEIGHT } ] }\n\t\t\t>\n\t\t\t\t<InnerBlocks template={ INNER_BLOCKS_TEMPLATE } />\n\t\t\t</View>\n\n\t\t\t<View pointerEvents=\"none\" style={ overlayStyles }>\n\t\t\t\t{ gradientValue && (\n\t\t\t\t\t<Gradient\n\t\t\t\t\t\tgradientValue={ gradientValue }\n\t\t\t\t\t\tstyle={ styles.background }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</View>\n\n\t\t\t<MediaUpload\n\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\tonSelect={ onSelectMedia }\n\t\t\t\trender={ renderBackground }\n\t\t\t/>\n\n\t\t\t{ shouldShowFailure && (\n\t\t\t\t<View\n\t\t\t\t\tpointerEvents=\"none\"\n\t\t\t\t\tstyle={ styles.uploadFailedContainer }\n\t\t\t\t>\n\t\t\t\t\t<View style={ styles.uploadFailed }>\n\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\ticon={ 'warning' }\n\t\t\t\t\t\t\t{ ...styles.uploadFailedIcon }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t</View>\n\t\t\t) }\n\t\t</View>\n\t);\n};\n\nexport default compose( [\n\twithColors( { overlayColor: 'background-color' } ),\n\twithSelect( ( select, { clientId } ) => {\n\t\tconst { getSelectedBlockClientId } = select( 'core/block-editor' );\n\n\t\tconst selectedBlockClientId = getSelectedBlockClientId();\n\n\t\treturn {\n\t\t\tisParentSelected: selectedBlockClientId === clientId,\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n] )( Cover );\n"]}